<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω–µ—Ä –Ω–∞–≤—á–∞–Ω–Ω—è</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container-app">
        <div id="overlay" class="overlay" onclick="closeSidebar()"></div>
        <header>
            <div class="header-top">
                <h1>–ü–ª–∞–Ω–µ—Ä –Ω–∞–≤—á–∞–Ω–Ω—è</h1>
                <div class="header-controls">
                    <button class="menu-toggle" onclick="toggleSidebar()" aria-label="–ú–µ–Ω—é">‚ò∞</button>
                    <button class="auth-btn login-btn" onclick="location.href='auth.html?action=login'">–£–≤—ñ–π—Ç–∏</button>
                    <button class="auth-btn register-btn" onclick="location.href='auth.html?action=register'">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</button>
                    <button class="theme-toggle" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏ —Ç–µ–º—É">üåô</button>
                    <span id="userInfo" class="user-info" style="display:none">–ü—Ä–∏–≤—ñ—Ç, <strong id="currentUserName"></strong> <button class="auth-btn" onclick="logoutUser()">–í–∏–π—Ç–∏</button></span>
                </div>
            </div>
            <p>–û—Ä–≥–∞–Ω—ñ–∑—É–π —Å–≤–æ—î –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è</p>
        </header>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-section">
            <div class="stat-card">
                <span class="stat-label">–í—Å—å–æ–≥–æ –¥–∑</span>
                <span class="stat-value" id="totalTasks">0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">–ó—Ä–æ–±–ª–µ–Ω–æ</span>
                <span class="stat-value" id="completedTasks">0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç</span>
                <span class="stat-value" id="completionPercent">0%</span>
            </div>
        </div>

        <main>
            <div class="sidebar">
                <h2>–ü—Ä–µ–¥–º–µ—Ç–∏</h2>
                
                <div class="add-subject">
                    <input type="text" id="newSubject" placeholder="–ù–æ–≤–∏–π –ø—Ä–µ–¥–º–µ—Ç" />
                    <button onclick="addSubject()">‚ûï</button>
                </div>

                <ul id="subjectList" class="subject-list">
                    <li class="subject-item active" onclick="selectSubject(this, '–ê–ª–≥–µ–±—Ä–∞')">
                        <span>–ê–ª–≥–µ–±—Ä–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–£–∫—Ä –º–æ–≤–∞')">
                        <span>–£–∫—Ä –º–æ–≤–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ê–Ω–≥–ª –º–æ–≤–∞')">
                        <span>–ê–Ω–≥–ª –º–æ–≤–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–§–∏–∑–∏–∫–∞')">
                        <span>–§—ñ–∑–∏–∫–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–•–∏–º–∏—è')">
                        <span>–•—ñ–º—ñ—è</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞')">
                        <span>–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–§–∏–∑—Ä–∞')">
                        <span>–§—ñ–∑–∫—É–ª—å—Ç—É—Ä–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ï–∫–æ–Ω–æ–º–∏–∫–∞')">
                        <span>–ï–∫–æ–Ω–æ–º–∏–∫–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è')">
                        <span>–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ó–∞—Ä—É–±–µ–∂–∫–∞')">
                        <span>–ó–∞—Ä—É–±—ñ–∂–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ë–∏–æ–ª–æ–≥–∏—è')">
                        <span>–ë—ñ–æ–ª–æ–≥—ñ—è</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ü—Ä–∞–≤–æ–∑–Ω–∞–≤—Å—Ç–≤–æ')">
                        <span>–ü—Ä–∞–≤–æ–∑–Ω–∞–≤—Å—Ç–≤–æ</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ú–∏—Å—Ç–µ—Ü—Ç–≤–æ')">
                        <span>–ú–∏—Å—Ç–µ—Ü—Ç–≤–æ</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–û–î–î')">
                        <span>–û–î–î</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–£–∫—Ä –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞')">
                        <span>–£–∫—Ä –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è')">
                        <span>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–û—Å–Ω–æ–≤–∏ –ø–æ–¥–∞—Ç–∫—ñ–≤')">
                        <span>–û—Å–Ω–æ–≤–∏ –ø–æ–¥–∞—Ç–∫—ñ–≤</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–û—Å–Ω–æ–≤–∏ –∑–¥–æ—Ä–æ–≤—å—è')">
                        <span>–û—Å–Ω–æ–≤–∏ –∑–¥–æ—Ä–æ–≤—å—è</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ì–µ–æ–º–µ—Ç—Ä–∏—è')">
                        <span>–ì–µ–æ–º–µ—Ç—Ä–∏—è</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ò—Å—Ç–æ—Ä–∏—è')">
                        <span>–ò—Å—Ç–æ—Ä–∏—è</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, 'STEM')">
                        <span>STEM</span>
                    </li>
                    <li class="subject-item" onclick="selectSubject(this, '–ó–∞—Ä—É–±–µ—Ä–µ–∂–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞')">
                        <span>–ó–∞—Ä—É–±—ñ–∂–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞</span>
                    </li>
                </ul>
            </div>

            <div class="content">
                <div class="subject-header">
                    <h2 id="currentSubject"> –ê–ª–≥–µ–±—Ä–∞</h2>
                    <button id="deleteSubjectBtn" class="delete-btn" onclick="deleteCurrentSubject()" style="display: none;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>

                <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div class="filter-section">
                    <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –î–ó..." onkeyup="filterTasks()">
                    <select id="filterSelect" onchange="filterTasks()">
                        <option value="all">–£—Å—ñ</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ñ</option>
                        <option value="completed">–í–∏–∫–æ–Ω–∞–Ω—ñ</option>
                        <option value="high">–í–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</option>
                    </select>
                </div>

                <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –î–ó -->
                <div class="task-input-section">
                    <h3>–î–æ–¥–∞—Ç–∏ –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è</h3>
                    <div class="input-group">
                        <input type="text" id="taskInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è..." />
                        <input type="date" id="taskDate" />
                        <select id="prioritySelect">
                            <option value="low">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–∏–∑–∫–∏–π</option>
                            <option value="medium" selected>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="high">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í—ã—Å–æ–∫–∏–π</option>
                        </select>
                        <select id="difficultySelect">
                            <option value="1">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: –õ–µ–≥–∫–æ</option>
                            <option value="2" selected>–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: –°–µ—Ä–µ–¥–Ω—å–æ</option>
                            <option value="3">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: –°–∫–ª–∞–¥–Ω–æ</option>
                            <option value="4">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: –î—É–∂–µ —Å–∫–ª–∞–¥–Ω–æ</option>
                            <option value="5">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: –ï–∫—Å—Ç—Ä–∞</option>
                        </select>
                        <button onclick="openTaskModal()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    <textarea id="taskNotes" placeholder="–ó–∞–º—ñ—Ç–∫–∏..." style="width: 100%; min-height: 60px; margin-top: 10px;"></textarea>
                </div>

                <!-- –ó–∞–¥–∞—á–∏ -->
                <div class="tasks-section">
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('active')">–ê–∫—Ç–∏–≤–Ω—ñ</button>
                        <button class="tab" onclick="switchTab('completed')">–í–∏–∫–æ–Ω–∞–Ω—ñ</button>
                        <button class="tab" onclick="switchTab('calendar')">–ö–∞–ª–µ–Ω–¥–∞—Ä</button>
                    </div>

                    <div id="activeTab" class="tab-content active">
                        <ul id="taskList" class="task-list"></ul>
                        <div id="emptyMessage" class="empty-message">
                            <p>–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–¥–∞—á üòå</p>
                        </div>
                    </div>

                    <div id="completedTab" class="tab-content">
                        <ul id="completedList" class="task-list"></ul>
                        <div id="emptyCompletedMessage" class="empty-message">
                            <p>–ù–µ–º–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö –∑–∞–¥–∞—á</p>
                        </div>
                    </div>

                    <div id="calendarTab" class="tab-content">
                        <div id="calendar" class="calendar-widget"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Login / Register modals -->
    <div id="loginModal" class="modal" onclick="if(event.target===this) closeModal('loginModal')">
        <div class="modal-content">
            <h3>–£–≤—ñ–π—Ç–∏</h3>
            <input id="loginUsername" placeholder="–õ–æ–≥—ñ–Ω" />
            <input id="loginPassword" type="password" placeholder="–ü–∞—Ä–æ–ª—å" />
            <div style="display:flex;gap:8px;margin-top:10px;">
                <button onclick="loginUser()" class="auth-btn register-btn">–£–≤—ñ–π—Ç–∏</button>
                <button onclick="closeModal('loginModal')" class="auth-btn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <div id="registerModal" class="modal" onclick="if(event.target===this) closeModal('registerModal')">
        <div class="modal-content">
            <h3>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h3>
            <input id="regUsername" placeholder="–õ–æ–≥—ñ–Ω" />
            <input id="regPassword" type="password" placeholder="–ü–∞—Ä–æ–ª—å" />
            <input id="regConfirm" type="password" placeholder="–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –ø–∞—Ä–æ–ª—å" />
            <div style="display:flex;gap:8px;margin-top:10px;">
                <button onclick="registerUser()" class="auth-btn register-btn">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</button>
                <button onclick="closeModal('registerModal')" class="auth-btn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        const subjects = {};
        let currentSubject = '–ê–ª–≥–µ–±—Ä–∞';
        let currentFilter = 'all';
        let currentTab = 'active';
        let currentStars = 3;
        let isDarkTheme = localStorage.getItem('darkTheme') === 'true';

        function init() {
            if (isDarkTheme) document.body.classList.add('dark-theme');
            loadFromStorage();
            renderTasks();
            updateStats();
            setStars(3);
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('darkTheme', isDarkTheme);
        }

        // --- Simple auth (localStorage) ---
        const users = {};
        let currentUser = localStorage.getItem('plannerCurrentUser') || null;

        function loadUsers() {
            const stored = localStorage.getItem('plannerUsers');
            if (stored) {
                try { Object.assign(users, JSON.parse(stored)); } catch(e) { }
            }
        }

        function saveUsers() {
            localStorage.setItem('plannerUsers', JSON.stringify(users));
        }

        function openLogin() {
            // backward-compatible: redirect to auth page
            location.href = 'auth.html?action=login';
        }

        function openRegister() {
            // backward-compatible: redirect to auth page
            location.href = 'auth.html?action=register';
        }

        function closeModal(id) {
            const el = document.getElementById(id);
            if (el) el.classList.remove('open');
        }

        function registerUser() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirm = document.getElementById('regConfirm').value;
            if (!username || !password) { showNotification('–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω —ñ –ø–∞—Ä–æ–ª—å'); return; }
            if (password !== confirm) { showNotification('–ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å'); return; }
            if (users[username]) { showNotification('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ —ñ—Å–Ω—É—î'); return; }
            users[username] = { pwd: btoa(password) };
            saveUsers();
            currentUser = username;
            localStorage.setItem('plannerCurrentUser', currentUser);
            // clear inputs
            document.getElementById('regUsername').value = '';
            document.getElementById('regPassword').value = '';
            document.getElementById('regConfirm').value = '';
            updateAuthUI();
            closeModal('registerModal');
            showNotification('–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞');
        }

        function loginUser() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            if (!username || !password) { showNotification('–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω —ñ –ø–∞—Ä–æ–ª—å'); return; }
            if (!users[username] || users[username].pwd !== btoa(password)) { showNotification('–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ'); return; }
            currentUser = username;
            localStorage.setItem('plannerCurrentUser', currentUser);
            // clear inputs
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            updateAuthUI();
            closeModal('loginModal');
            showNotification('–í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π');
        }

        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('plannerCurrentUser');
            updateAuthUI();
            showNotification('–í–∏ –≤–∏–π—à–ª–∏');
        }

        function updateAuthUI() {
            const userInfo = document.getElementById('userInfo');
            const userNameEl = document.getElementById('currentUserName');
            const loginBtns = document.querySelectorAll('.login-btn, .register-btn');
            if (currentUser) {
                loginBtns.forEach(b => b.style.display = 'none');
                userInfo.style.display = 'inline-flex';
                userNameEl.textContent = currentUser;
            } else {
                loginBtns.forEach(b => b.style.display = 'inline-block');
                userInfo.style.display = 'none';
                userNameEl.textContent = '';
            }
        }

        function toggleSidebar() {
            const sb = document.querySelector('.sidebar');
            if (!sb) return;
            sb.classList.toggle('open');
            const ov = document.getElementById('overlay');
            if (sb.classList.contains('open')) ov.classList.add('open'); else ov.classList.remove('open');
        }

        function closeSidebar(){
            const sb = document.querySelector('.sidebar');
            const ov = document.getElementById('overlay');
            if(sb) sb.classList.remove('open');
            if(ov) ov.classList.remove('open');
        }

        loadUsers();
        updateAuthUI();

        function addSubject() {
            const input = document.getElementById('newSubject');
            const subjectName = input.value.trim();
            
            if (!subjectName) {
                alert('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø—Ä–µ–¥–º–µ—Ç–∞');
                return;
            }
            if (subjects[subjectName]) {
                alert('–¢–∞–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç –≤–∂–µ —ñ—Å–Ω—É—î');
                return;
            }

            subjects[subjectName] = [];
            input.value = '';
            renderSubjects();
            saveToStorage();
        }

        function selectSubject(element, subjectName) {
            document.querySelectorAll('.subject-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
            
            currentSubject = subjectName;
            document.getElementById('currentSubject').textContent = subjectName;
            
            const deleteBtn = document.getElementById('deleteSubjectBtn');
            const isDefault = ['–ê–ª–≥–µ–±—Ä–∞', '–£–∫—Ä –º–æ–≤–∞', '–ê–Ω–≥–ª –º–æ–≤–∞', '–§—ñ–∑–∏–∫–∞', '–•—ñ–º—ñ—è', '–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–§—ñ–∑–∫—É–ª—å—Ç—É—Ä–∞', '–ï–∫–æ–Ω–æ–º—ñ–∫–∞', '–ì–µ–æ–≥—Ä–∞—Ñ—ñ—è', '–ó–∞—Ä—É–±–µ–∂–∫–∞', '–ë—ñ–æ–ª–æ–≥—ñ—è', '–ü—Ä–∞–≤–æ–∑–Ω–∞–≤—Å—Ç–≤–æ', '–ú–∏—Å—Ç–µ—Ü—Ç–≤–æ', '–û–î–î', '–£–∫—Ä –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—è', '–û—Å–Ω–æ–≤–∏ –ø–æ–¥–∞—Ç–∫—ñ–≤', '–û—Å–Ω–æ–≤–∏ –∑–¥–æ—Ä–æ–≤\'—è', '–ì–µ–æ–º–µ—Ç—Ä—ñ—è', '–Ü—Å—Ç–æ—Ä—ñ—è', 'STEM', '–ó–∞—Ä—É–±–µ—Ä–µ–∂–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞'].includes(subjectName);
            deleteBtn.style.display = isDefault ? 'none' : 'block';
            
            currentFilter = 'all';
            document.getElementById('filterSelect').value = 'all';
            document.getElementById('searchInput').value = '';
            
            currentTab = 'active';
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab').classList.add('active');
            document.getElementById('activeTab').classList.add('active');
            
            renderTasks();
            // on small screens close sidebar automatically after selecting a subject
            if (window.innerWidth <= 700) {
                closeSidebar();
            }
        }

        function deleteCurrentSubject() {
            if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç —ñ –≤—Å—ñ –π–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è?')) {
                delete subjects[currentSubject];
                currentSubject = '–ê–ª–≥–µ–±—Ä–∞';
                renderSubjects();
                selectSubject(document.querySelector('.subject-item') || document.querySelector('.subject-item.active'), '–ê–ª–≥–µ–±—Ä–∞');
                saveToStorage();
            }
        }

        function setStars(num) {
            currentStars = num;
            const stars = document.querySelectorAll('.stars .star');
            stars.forEach((star, index) => {
                if (index < num) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function openTaskModal() {
            const taskInput = document.getElementById('taskInput');
            const taskDate = document.getElementById('taskDate');
            const prioritySelect = document.getElementById('prioritySelect');
            const difficultySelect = document.getElementById('difficultySelect');
            const taskNotes = document.getElementById('taskNotes');
            const taskText = taskInput.value.trim();
            const dueDate = taskDate.value;
            const priority = prioritySelect.value;
            const difficulty = parseInt(difficultySelect.value);
            const notes = taskNotes.value.trim();
            
            if (!taskText) {
                alert('–í–≤–µ–¥—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è');
                return;
            }
            
            if (!subjects[currentSubject]) {
                subjects[currentSubject] = [];
            }
            
            subjects[currentSubject].push({
                text: taskText,
                date: dueDate,
                priority: priority,
                difficulty: difficulty,
                notes: notes,
                completed: false,
                id: Date.now(),
                completedDate: null
            });
            
            taskInput.value = '';
            taskDate.value = '';
            prioritySelect.value = 'medium';
            difficultySelect.value = '2';
            taskNotes.value = '';
            renderTasks();
            updateStats();
            saveToStorage();
            showNotification('–ó–∞–¥–∞—á–∞ –¥–æ–¥–∞–Ω–∞! ‚úÖ');
        }

        function showNotification(message) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        function filterTasks() {
            currentFilter = document.getElementById('filterSelect').value;
            renderTasks();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            if (tab === 'active') {
                tabs[0].classList.add('active');
                document.getElementById('activeTab').classList.add('active');
            } else if (tab === 'completed') {
                tabs[1].classList.add('active');
                document.getElementById('completedTab').classList.add('active');
            } else if (tab === 'calendar') {
                tabs[2].classList.add('active');
                document.getElementById('calendarTab').classList.add('active');
                renderCalendar();
            }
        }

        function renderTasks() {
            const taskList = document.getElementById('taskList');
            const completedList = document.getElementById('completedList');
            const emptyMessage = document.getElementById('emptyMessage');
            const emptyCompletedMessage = document.getElementById('emptyCompletedMessage');
            
            taskList.innerHTML = '';
            completedList.innerHTML = '';
            
            const tasks = subjects[currentSubject] || [];
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let activeTasks = [];
            let completedTasks = [];
            
            tasks.forEach(task => {
                if (!task.text.toLowerCase().includes(searchTerm)) return;
                
                if (task.completed) {
                    completedTasks.push(task);
                } else {
                    activeTasks.push(task);
                }
            });

            activeTasks = activeTasks.filter(task => {
                if (currentFilter === 'high') return task.priority === 'high';
                return true;
            });

            emptyMessage.style.display = activeTasks.length === 0 ? 'block' : 'none';
            emptyCompletedMessage.style.display = completedTasks.length === 0 ? 'block' : 'none';

            activeTasks.forEach(task => {
                taskList.appendChild(createTaskElement(task));
            });

            completedTasks.forEach(task => {
                completedList.appendChild(createTaskElement(task));
            });
        }

        function createTaskElement(task) {
            const li = document.createElement('li');
            li.className = 'task-item';
            
            if (task.priority === 'high') li.classList.add('priority-high');
            if (task.priority === 'medium') li.classList.add('priority-medium');
            if (task.priority === 'low') li.classList.add('priority-low');
            
            let difficultyText = '';
            if (task.difficulty === 1) difficultyText = '–õ–µ–≥–∫–æ';
            else if (task.difficulty === 2) difficultyText = '–°—Ä–µ–¥–Ω—î';
            else if (task.difficulty === 3) difficultyText = '–°–∫–ª–∞–¥–Ω–æ';
            else if (task.difficulty === 4) difficultyText = '–î—É–∂–µ —Å–∫–ª–∞–¥–Ω–æ';
            else if (task.difficulty === 5) difficultyText = '–ï–∫—Å—Ç—Ä–∞';
            
            let priorityText = '';
            if (task.priority === 'high') priorityText = '–í–∏—Å–æ–∫–∏–π';
            else if (task.priority === 'medium') priorityText = '–°–µ—Ä–µ–¥–Ω—ñ–π';
            else if (task.priority === 'low') priorityText = '–ù–∏–∑—å–∫–∏–π';
            
            const dateStr = task.date ? new Date(task.date).toLocaleDateString('ru-RU') : '';
            
            li.innerHTML = `
                <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask(${task.id})">
                <div class="task-content">
                    <span class="task-text ${task.completed ? 'completed' : ''}">${task.text}</span>
                    <div class="task-meta">
                        ${task.date ? `<span class="task-date">${dateStr}</span>` : ''}
                        <span class="task-priority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${priorityText}</span>
                        <span class="task-difficulty">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å: ${difficultyText}</span>
                    </div>
                    ${task.notes ? `<div class="task-notes">–ó–∞–º—ñ—Ç–∫–∞: ${task.notes}</div>` : ''}
                </div>
                <button class="delete-btn" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
            `;
            
            return li;
        }

        function toggleTask(taskId) {
            const task = subjects[currentSubject].find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                task.completedDate = task.completed ? new Date().toISOString() : null;
                renderTasks();
                updateStats();
                saveToStorage();
            }
        }

        function deleteTask(taskId) {
            subjects[currentSubject] = subjects[currentSubject].filter(t => t.id !== taskId);
            renderTasks();
            updateStats();
            saveToStorage();
        }

        function updateStats() {
            let totalTasks = 0;
            let completedTasks = 0;
            
            for (let subject in subjects) {
                subjects[subject].forEach(task => {
                    totalTasks++;
                    if (task.completed) completedTasks++;
                });
            }
            
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('completionPercent').textContent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) + '%' : '0%';
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '<p>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è...</p>';
            
            const today = new Date();
            const month = today.getMonth();
            const year = today.getFullYear();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            let html = `<div class="calendar"><h3>${firstDay.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' })}</h3>`;
            html += '<div class="calendar-grid">';
            
            const daysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥'];
            daysOfWeek.forEach(day => html += `<div class="calendar-header">${day}</div>`);
            
            for (let i = 0; i < firstDay.getDay() - 1; i++) {
                html += '<div></div>';
            }
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day).toISOString().split('T')[0];
                let count = 0;
                for (let subject in subjects) {
                    count += subjects[subject].filter(t => t.date === date && !t.completed).length;
                }
                html += `<div class="calendar-day ${count > 0 ? 'has-tasks' : ''}">${day}${count > 0 ? `<span>(${count})</span>` : ''}</div>`;
            }
            
            html += '</div></div>';
            calendar.innerHTML = html;
        }

        function exportData() {
            let text = '=== –ù–ê–í–ß–ê–õ–¨–ù–ò–ô –ü–õ–ê–ù–ï–† ===\n\n';
            for (let subject in subjects) {
                text += `\nüìö ${subject}\n`;
                text += '-'.repeat(40) + '\n';
                const tasks = subjects[subject];
                if (tasks.length === 0) {
                    text += '–ù–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å\n';
                } else {
                    tasks.forEach(task => {
                        const status = task.completed ? '‚úÖ' : 'üìù';
                        const priority = task.priority === 'high' ? 'üî¥' : task.priority === 'medium' ? 'üü°' : 'üü¢';
                        const stars = '‚≠ê'.repeat(task.difficulty) + '‚òÜ'.repeat(5 - task.difficulty);
                        text += `${status} ${priority} ${task.text}\n`;
                        text += `   ${stars} | ${task.date || '–ë–µ–∑ –¥–∞—Ç–∏'}\n`;
                        if (task.notes) text += `   –ó–∞–º—ñ—Ç–∫–∞: ${task.notes}\n`;
                        text += '\n';
                    });
                }
            }
            
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `–ø–ª–∞–Ω–µ—Ä_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
        }

        function saveToStorage() {
            localStorage.setItem('plannerSubjects', JSON.stringify(subjects));
        }

        function loadFromStorage() {
            const stored = localStorage.getItem('plannerSubjects');
            if (stored) {
                const loaded = JSON.parse(stored);
                for (let subject in loaded) {
                    subjects[subject] = loaded[subject];
                }
            } else {
                const defaultSubjects = ['–ê–ª–≥–µ–±—Ä–∞', '–£–∫—Ä –º–æ–≤–∞', '–ê–Ω–≥–ª –º–æ–≤–∞', '–§—ñ–∑–∏–∫–∞', '–•–∏—ñ–º—ñ—è', '–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–§—ñ–∑–∫—É–ª—å—Ç—É—Ä–∞', '–ï–∫–æ–Ω–æ–º—ñ–∫–∞', '–ì–µ–æ–≥—Ä–∞—Ñ—ñ—è', '–ó–∞—Ä—É–±—ñ–∂–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ë—ñ    –æ–ª–æ–≥–∏—è', '–ü—Ä–∞–≤–æ–∑–Ω–∞–≤—Å—Ç–≤–æ', '–ú–∏—Å—Ç–µ—Ü—Ç–≤–æ', '–û–î–î', '–£–∫—Ä –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è', '–û—Å–Ω–æ–≤–∏ –ø–æ–¥–∞—Ç–∫—ñ–≤', '–û—Å–Ω–æ–≤–∏ –∑–¥–æ—Ä–æ–≤—å—è', '–ì–µ–æ–º–µ—Ç—Ä–∏—è', '–ò—Å—Ç–æ—Ä–∏—è', 'STEM', '–ó–∞—Ä—É–±–µ—Ä–µ–∂–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞'];
                defaultSubjects.forEach(subject => subjects[subject] = []);
            }
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
